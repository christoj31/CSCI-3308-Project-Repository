<div class="container mt-5">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Job ID</th>
                <th>Job Name</th>
                <th>Job Link</th>
                <th>Status</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {{#each results}}
            <tr>
                <td>{{jobid}}</td>
                <td>{{jobtitle}}</td>
                <td><a class="link link-secondary link-hover" href="{{jobapplicationlink}}">{{jobapplicationlink}}</a></td>
                <td>{{status}}</td>
                <td>
                    <button class="btn btn-secondary"
                        onclick="editModal(this)"
                        data-jobid="{{jobid}}"
                        data-jobtitle="{{jobtitle}}"
                        data-joblink="{{jobapplicationlink}}">
                        Edit
                    </button>                
                </td>
                <td>
                    <button class="btn btn-secondary"
                        onclick="deleteModal(this)"
                        data-jobid="{{jobid}}">
                        ✕
                        </button>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

<dialog id="edit_modal" class="modal">
    <div class="modal-box">
    <form method="dialog">
    <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
    </form>
    <h3 class="text-lg font-bold text-center">Edit Event:</h3>
    <form action="/editModal" method="POST">
    <div class="form-group">
            <input ctype="text" class="input input-bordered w-full" id="jobid" name="jobid" style="display: none;">
        </div>
        <div class="form-label" style="display: none;">
            <label for="jobid">jobid:</label>
        </div>
        <div class="form-group">
            <input ctype="text" class="input input-bordered w-full" id="jobid_holder" name="jobid_holder" disabled>
        </div>
        <div class="form-label">
            <label for="jobid_holder">Job ID:</label>
        </div>
        <div class="form-group">
            <input ctype="text" class="input input-bordered w-full" id="edit_job_name" name="job_name" placeholder="enter the job name...">
        </div>
        <div class="form-label">
            <label for="job_name">Job Name:</label>
        </div>
        <div class="form-group">
            <input type="link" class="input input-bordered w-full" id="edit_job_link" name="job_link" placeholder="enter the job link...">
        </div>
        <div class="form-label">
            <label for="job link">Job Link:</label>
        </div>
        <div class="form-group">
            <select class="input input-bordered w-full" id="status" name="status">
                <option>Select Status...</option>
                <option value="applied">Applied</option>
                <option value="not-applied">Not Applied</option>
                <option value="accepted">Accepted</option>
                <option value="denied">Denied</option>
            </select>
        </div>
        <div class="form-label" style="padding-bottom: 15px;">
            <label for="status">Status:</label>
        </div>
    
        <button type="submit" class="btn btn-primary" style="float: right; padding: 15px 32px;">Update</button>
    </form>
        <div style="padding-top: 20px">
            <form method="dialog">
                <button class="btn btn-secondary" style="float: right; margin-right: 5px;">Close</button>
            </form>
        </div>
    </div>
</dialog>

<!--Delete Modal-->
<dialog id="delete_modal" class="modal">
    <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
</dialog>

<script>
function editModal(button) {
    console.log('Edit modal');
    const jobId = button.getAttribute('data-jobid');
    const jobid_holder = button.getAttribute('data-jobid');
    console.log(jobid_holder);
    const jobTitle = button.getAttribute('data-jobtitle');
    const jobLink = button.getAttribute('data-joblink');

    console.log('JOBID & JOBIDHOLDER: ', jobId, jobid_holder);

    console.log('Job info: ', jobId, jobTitle, jobLink);

    document.getElementById('jobid').value = jobId;
    document.getElementById('jobid_holder').value = jobId;
    document.getElementById('edit_job_name').value = jobTitle;
    document.getElementById('edit_job_link').value = jobLink;

    // Open the modal dialog
    document.getElementById('edit_modal').showModal();
}

function deleteModal(button) {
    const jobId = button.getAttribute('data-jobid');
    document.getElementById('delete-modal').showModal();

    fetch(`/home/${jobId}`, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json'}
    })
    .then(response => response.json())
    .then(data => {
        console.log(data.message);

        const row = button.closest("tr");
        if (row) {
            row.remove();
        }

        document.getElementById('delete_modal').close();
    })
    .catch(error => console.error('Error deleting job:', error));
}
</script>